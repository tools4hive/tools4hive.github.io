import{f as gt,a as W,c as Ht,t as St}from"../chunks/BJubvyB6.js";import"../chunks/BkBSw33i.js";import{o as Et}from"../chunks/C3ujLynq.js";import{an as jt,z as A,aw as ct,ax as Tt,ap as It,g as e,c as q,aa as w,s as Q,r as K,aq as Lt,ao as Nt}from"../chunks/C0eYg5ZO.js";import{e as ut}from"../chunks/DLXh71OA.js";import{i as et}from"../chunks/C4woFUEF.js";import{r as Pt}from"../chunks/fXtS6jfd.js";import{b as $t,d as ft}from"../chunks/CGbNmFIo.js";import{i as Ft}from"../chunks/Be78SR8q.js";import{d as Gt}from"../chunks/Cx3hapoI.js";import{C as Jt}from"../chunks/DVPQgroo.js";import{i as ht,s as X,a as Rt,b as Ut,l as zt}from"../chunks/D_z5dxpE.js";class dt extends Map{constructor(o,i=Kt){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),o!=null)for(const[n,r]of o)this.set(n,r)}get(o){return super.get(mt(this,o))}has(o){return super.has(mt(this,o))}set(o,i){return super.set(Vt(this,o),i)}delete(o){return super.delete(qt(this,o))}}function mt({_intern:t,_key:o},i){const n=o(i);return t.has(n)?t.get(n):i}function Vt({_intern:t,_key:o},i){const n=o(i);return t.has(n)?t.get(n):(t.set(n,i),i)}function qt({_intern:t,_key:o},i){const n=o(i);return t.has(n)&&(i=t.get(n),t.delete(n)),i}function Kt(t){return t!==null&&typeof t=="object"?t.valueOf():t}function Wt(t,o,i){t=+t,o=+o,i=(r=arguments.length)<2?(o=t,t=0,1):r<3?1:+i;for(var n=-1,r=Math.max(0,Math.ceil((o-t)/i))|0,s=new Array(r);++n<r;)s[n]=t+n*i;return s}const pt=Symbol("implicit");function yt(){var t=new dt,o=[],i=[],n=pt;function r(s){let v=t.get(s);if(v===void 0){if(n!==pt)return n;t.set(s,v=o.push(s)-1)}return i[v%i.length]}return r.domain=function(s){if(!arguments.length)return o.slice();o=[],t=new dt;for(const v of s)t.has(v)||t.set(v,o.push(v)-1);return r},r.range=function(s){return arguments.length?(i=Array.from(s),r):i.slice()},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return yt(o,i).unknown(n)},ht.apply(r,arguments),r}function nt(){var t=yt().unknown(void 0),o=t.domain,i=t.range,n=0,r=1,s,v,C=!1,b=0,D=0,T=.5;delete t.unknown;function h(){var d=o().length,$=r<n,B=$?r:n,x=$?n:r;s=(x-B)/Math.max(1,d-b+D*2),C&&(s=Math.floor(s)),B+=(x-B-s*(d-b))*T,v=s*(1-b),C&&(B=Math.round(B),v=Math.round(v));var I=Wt(d).map(function(J){return B+s*J});return i($?I.reverse():I)}return t.domain=function(d){return arguments.length?(o(d),h()):o()},t.range=function(d){return arguments.length?([n,r]=d,n=+n,r=+r,h()):[n,r]},t.rangeRound=function(d){return[n,r]=d,n=+n,r=+r,C=!0,h()},t.bandwidth=function(){return v},t.step=function(){return s},t.round=function(d){return arguments.length?(C=!!d,h()):C},t.padding=function(d){return arguments.length?(b=Math.min(1,D=+d),h()):b},t.paddingInner=function(d){return arguments.length?(b=Math.min(1,d),h()):b},t.paddingOuter=function(d){return arguments.length?(D=+d,h()):D},t.align=function(d){return arguments.length?(T=Math.max(0,Math.min(1,d)),h()):T},t.copy=function(){return nt(o(),[n,r]).round(C).paddingInner(b).paddingOuter(D).align(T)},ht.apply(h(),arguments)}var Qt=gt('<br/> <div class="animate-ping">Loading Account History</div> <br/>',1),Xt=gt('<main slot="content"><div class="flex flex-col items-center gap-3 w-full"><label class="flex flex-col items-center gap-2 text-sm font-semibold text-gray-600 w-full max-w-[14rem]"><div class="flex w-full items-center gap-2 justify-center"><input type="text" placeholder="Account Name" class="w-full rounded-xl border px-3 py-2 text-base text-ht_hiveblack focus:border-ht_hiveblack focus:outline-none text-center border-gray-300"/> <button class="rounded-full border px-5 py-2 text-sm font-semibold shadow focus:outline-none transition whitespace-nowrap bg-white text-ht_hiveblack border-gray-200" style="box-shadow:0 10px 25px -12px rgba(0,0,0,0.5);">Load</button></div></label></div> <br/> <div class="inline-block text-lg text-ht_hiveblack font-medium title-font mb-2"><br/> <!> <div id="chart"></div> <!></div></main>');function ue(t,o){jt(o,!1);const i=A();let n="Account activity",r=A(!1),s,v,C,b,D=A(""),T=A(!1),h,d=0,$=0,B="",x=A(null);const I=[{key:"vote",label:"Votes"},{key:"blog",label:"Blog posts"},{key:"comment",label:"Comments"},{key:"custom",label:"Custom JSON"},{key:"other",label:"Other"}];let J=A(I.reduce((c,l)=>({...c,[l.key]:!0}),{})),vt=A(I.map(c=>({key:c.key,label:c.label,count:0}))),R=A([]),F=A({}),rt={},U=A([]),G=A({}),at={},bt="",_t="",kt="",wt="";Et(async function(){Y()});const xt=c=>{c.code==="Enter"&&Y()};function H(){return Array.from({length:7},()=>Array(24).fill(0))}function Mt(){return{vote:H(),blog:H(),comment:H(),custom:H(),other:H()}}function Ot(c){if(!c||!c.length)return"other";const[l,m]=c;return l==="vote"?"vote":l==="comment"?m!=null&&m.parent_author?"comment":"blog":l==="custom_json"?"custom":"other"}function At(){if(!e(x))return H();const c=H(),l=m=>{for(let p=0;p<7;p++)for(let u=0;u<24;u++)c[p][u]+=m[p][u]};for(const{key:m}of I)if(e(J)[m]){if(m==="other"){const p=e(R).length?e(R):[["__all__",0]];for(const[u]of p){if(u!=="__all__"&&!Ct(u))continue;const _=u==="__all__"?e(x).other:rt[u];_&&l(_)}continue}if(m==="custom"){const p=e(U).length?e(U):[["__all__",0]];for(const[u]of p){if(u!=="__all__"&&!Bt(u))continue;const _=u==="__all__"?e(x).custom:at[u];_&&l(_)}continue}l(e(x)[m])}return c}function Ct(c){return!e(R).length||Object.keys(e(F)).length===0?!0:e(F)[c]!==!1}function Dt(){if(!e(x))return;const c=At();X("#chart").select("svg").remove();var l={top:30,right:30,bottom:30,left:30},m=750-l.left-l.right,p=450-l.top-l.bottom,u=X("#chart").append("svg").attr("width",m+l.left+l.right).attr("height",p+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")"),_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],L=[0,1,2,3,4,5,6],y=nt().range([0,m]).domain(_).padding(.01);u.append("g").attr("transform","translate(0,"+p+")").call(Rt(y));var S=nt().range([p,0]).domain(L).padding(.01);u.append("g").call(Ut(S));var E=zt().range(["lightgray","yellow","orange","red"]).domain([1,200,800,4e3]),P=u.append("defs"),j=P.append("linearGradient").attr("id","linear-gradient");j.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),j.selectAll("stop").data(E.range()).enter().append("stop").attr("offset",function(a,M){return M/(E.range().length-1)}).attr("stop-color",function(a){return a});let N=[];for(var g=0;g<7;g++)for(var k=0;k<24;k++)N.push({hour:k,day:g,value:c[g][k]});u.selectAll().data(N,function(a){return a.hour+":"+a.day}).enter().append("rect").attr("x",function(a){return y(a.hour)}).attr("y",function(a){return S(a.day)}).attr("width",y.bandwidth()).attr("height",S.bandwidth()).style("fill",function(a){return E(a.value)});var f=u.append("g").attr("class","legendWrapper").attr("transform","translate("+(m/2-150)+","+(p+20)+")");f.append("rect").attr("width",300).attr("height",10).style("fill","url(#linear-gradient)")}function Bt(c){return!e(U).length||Object.keys(e(G)).length===0?!0:e(G)[c]!==!1}async function Y(){const c=e(D).trim();if(!c){b="",w(r,!1),C="",X("#chart").select("svg").remove();return}w(T,!0),C="",b="",w(r,!1),X("#chart").select("svg").remove();try{const l=new ft.Client(["https://api.hive.blog","https://api.hivekings.com","https://anyx.io","https://api.openhive.network"]),m=new ft.DatabaseAPI(l),p=await l.database.call("lookup_accounts",[c,1]);if(console.log(p),s=await l.database.call("get_accounts",[p]),v=await s[0],console.log(s),console.log(s[0]),c==s[0].name){if(s[0].json_metadata){let f=JSON.parse(s[0].json_metadata);f.profile&&(console.log(f.profile.profile_image),C=f.profile.profile_image)}b=s[0].name}b==""&&(b="!!! Account not found !!!");const u=await l.database.call("get_account_history",["exodegame","-1","10"]);console.log(u),bt=_t=kt=wt="M0 0";const _=Mt();let L=[],y=-1,S=1e3,E=!1;const P=new Map,j={},N=new Map,g={},k=I.reduce((f,a)=>({...f,[a.key]:0}),{});for(let f=0;f<20;f++)y!=0&&!E&&(y>0&&y<1e3&&(S=y),console.log("start: "+y),h=await m.getAccountHistory(c,y,S),console.log(h),await h.forEach(function(a){var it,st,lt;d++,$=a[0],B=a[1].timestamp,L.push($+" "+B+" "+a[1].op[1].id+" "+a[1].op[1].json+`
`),(y==-1||a[0]<y)&&(y=a[0]);var M=new Date(Date.parse(a[1].timestamp+"+00:00")),z=M.getUTCHours(),Z=M.getUTCDay(),ot=new Date,tt=new Date;if(tt.setDate(ot.getDate()-7),M>=tt&&M<=ot){const V=Ot(a[1].op);if(_[V][Z][z]+=50,k[V]=(k[V]||0)+1,V==="other"){const O=((it=a[1].op)==null?void 0:it[0])||"unknown";P.set(O,(P.get(O)||0)+1),j[O]||(j[O]=H()),j[O][Z][z]+=50}else if(V==="custom"){const O=((lt=(st=a[1].op)==null?void 0:st[1])==null?void 0:lt.id)||"unknown";N.set(O,(N.get(O)||0)+1),g[O]||(g[O]=H()),g[O][Z][z]+=50}}M<=tt&&(E=!0)}));w(x,_),w(vt,I.map(f=>({key:f.key,label:f.label,count:k[f.key]||0}))),rt=j,w(R,Array.from(P.entries()).sort((f,a)=>a[1]-f[1])),w(F,e(R).reduce((f,[a])=>({...f,[a]:e(F)[a]??!0}),{})),at=g,w(U,Array.from(N.entries()).sort((f,a)=>a[1]-f[1])),w(G,e(U).reduce((f,[a])=>({...f,[a]:e(G)[a]??!0}),{})),w(r,!0)}finally{w(T,!1)}h.forEach(function(l){d++}),h=await database.getAccountHistory("exodegame",-100,100),h.forEach(function(l){d++})}ct(()=>(e(J),e(F),e(G)),()=>{w(i,JSON.stringify({activity:e(J),other:e(F),custom:e(G)}))}),ct(()=>(e(x),e(r),e(i)),()=>{e(x)&&e(r)&&(e(i),Dt())}),Tt(),Ft(),Jt(t,{title:n,$$slots:{content:(c,l)=>{var m=Xt(),p=q(m),u=q(p),_=q(u),L=q(_);Pt(L);var y=Q(L,2);K(_),K(u),K(p);var S=Q(p,4),E=Q(q(S),2);{var P=g=>{var k=Qt();Lt(4),W(g,k)},j=g=>{var k=Ht(),f=Nt(k);{var a=M=>{var z=St("activity of the last week");W(M,z)};et(f,M=>{e(r)&&M(a)},!0)}W(g,k)};et(E,g=>{e(T)?g(P):g(j,!1)})}var N=Q(E,4);et(N,g=>{e(r)&&Gt}),K(S),K(m),ut("keypress",L,xt),$t(L,()=>e(D),g=>w(D,g)),ut("click",y,Y),W(c,m)}}}),It()}export{ue as component};

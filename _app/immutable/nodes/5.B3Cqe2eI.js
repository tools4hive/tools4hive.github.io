import{f as gt,a as W,c as Ht,t as St}from"../chunks/DwBZhfY9.js";import"../chunks/jNKSrVZX.js";import{o as Et}from"../chunks/B_KFFgX2.js";import{an as jt,z as A,ar as ct,as as Tt,ap as It,g as e,c as q,aa as w,s as Q,r as K,aq as Lt,ao as Nt}from"../chunks/DYcyahPS.js";import{e as ut}from"../chunks/D405-Ecp.js";import{i as et}from"../chunks/DlQfq1Aw.js";import{r as Pt}from"../chunks/D6XCIxjJ.js";import{b as $t,d as ft}from"../chunks/D4WxpaWO.js";import{i as Ft}from"../chunks/BZZSUikD.js";import{d as Gt}from"../chunks/hXFlL1QV.js";import{C as Jt}from"../chunks/CpWo5qyQ.js";import{i as ht,r as Rt,s as X,a as Ut,b as zt,l as Vt}from"../chunks/DlWHExRM.js";class dt extends Map{constructor(o,s=Wt){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:s}}),o!=null)for(const[r,a]of o)this.set(r,a)}get(o){return super.get(pt(this,o))}has(o){return super.has(pt(this,o))}set(o,s){return super.set(qt(this,o),s)}delete(o){return super.delete(Kt(this,o))}}function pt({_intern:t,_key:o},s){const r=o(s);return t.has(r)?t.get(r):s}function qt({_intern:t,_key:o},s){const r=o(s);return t.has(r)?t.get(r):(t.set(r,s),s)}function Kt({_intern:t,_key:o},s){const r=o(s);return t.has(r)&&(s=t.get(r),t.delete(r)),s}function Wt(t){return t!==null&&typeof t=="object"?t.valueOf():t}const mt=Symbol("implicit");function yt(){var t=new dt,o=[],s=[],r=mt;function a(l){let v=t.get(l);if(v===void 0){if(r!==mt)return r;t.set(l,v=o.push(l)-1)}return s[v%s.length]}return a.domain=function(l){if(!arguments.length)return o.slice();o=[],t=new dt;for(const v of l)t.has(v)||t.set(v,o.push(v)-1);return a},a.range=function(l){return arguments.length?(s=Array.from(l),a):s.slice()},a.unknown=function(l){return arguments.length?(r=l,a):r},a.copy=function(){return yt(o,s).unknown(r)},ht.apply(a,arguments),a}function nt(){var t=yt().unknown(void 0),o=t.domain,s=t.range,r=0,a=1,l,v,C=!1,b=0,D=0,T=.5;delete t.unknown;function h(){var d=o().length,$=a<r,B=$?a:r,x=$?r:a;l=(x-B)/Math.max(1,d-b+D*2),C&&(l=Math.floor(l)),B+=(x-B-l*(d-b))*T,v=l*(1-b),C&&(B=Math.round(B),v=Math.round(v));var I=Rt(d).map(function(J){return B+l*J});return s($?I.reverse():I)}return t.domain=function(d){return arguments.length?(o(d),h()):o()},t.range=function(d){return arguments.length?([r,a]=d,r=+r,a=+a,h()):[r,a]},t.rangeRound=function(d){return[r,a]=d,r=+r,a=+a,C=!0,h()},t.bandwidth=function(){return v},t.step=function(){return l},t.round=function(d){return arguments.length?(C=!!d,h()):C},t.padding=function(d){return arguments.length?(b=Math.min(1,D=+d),h()):b},t.paddingInner=function(d){return arguments.length?(b=Math.min(1,d),h()):b},t.paddingOuter=function(d){return arguments.length?(D=+d,h()):D},t.align=function(d){return arguments.length?(T=Math.max(0,Math.min(1,d)),h()):T},t.copy=function(){return nt(o(),[r,a]).round(C).paddingInner(b).paddingOuter(D).align(T)},ht.apply(h(),arguments)}var Qt=gt('<br/> <div class="animate-ping">Loading Account History</div> <br/>',1),Xt=gt('<main slot="content"><div class="flex flex-col items-center gap-3 w-full"><label class="flex flex-col items-center gap-2 text-sm font-semibold text-gray-600 w-full max-w-[14rem]"><div class="flex w-full items-center gap-2 justify-center"><input type="text" placeholder="Account Name" class="w-full rounded-xl border px-3 py-2 text-base text-ht_hiveblack focus:border-ht_hiveblack focus:outline-none text-center border-gray-300"/> <button class="rounded-full border px-5 py-2 text-sm font-semibold shadow focus:outline-none transition whitespace-nowrap bg-white text-ht_hiveblack border-gray-200" style="box-shadow:0 10px 25px -12px rgba(0,0,0,0.5);">Load</button></div></label></div> <br/> <div class="inline-block text-lg text-ht_hiveblack font-medium title-font mb-2"><br/> <!> <div id="chart"></div> <!></div></main>');function ue(t,o){jt(o,!1);const s=A();let r="Account activity",a=A(!1),l,v,C,b,D=A(""),T=A(!1),h,d=0,$=0,B="",x=A(null);const I=[{key:"vote",label:"Votes"},{key:"blog",label:"Blog posts"},{key:"comment",label:"Comments"},{key:"custom",label:"Custom JSON"},{key:"other",label:"Other"}];let J=A(I.reduce((c,i)=>({...c,[i.key]:!0}),{})),vt=A(I.map(c=>({key:c.key,label:c.label,count:0}))),R=A([]),F=A({}),rt={},U=A([]),G=A({}),at={},bt="",_t="",kt="",wt="";Et(async function(){Y()});const xt=c=>{c.code==="Enter"&&Y()};function H(){return Array.from({length:7},()=>Array(24).fill(0))}function Mt(){return{vote:H(),blog:H(),comment:H(),custom:H(),other:H()}}function Ot(c){if(!c||!c.length)return"other";const[i,p]=c;return i==="vote"?"vote":i==="comment"?p!=null&&p.parent_author?"comment":"blog":i==="custom_json"?"custom":"other"}function At(){if(!e(x))return H();const c=H(),i=p=>{for(let m=0;m<7;m++)for(let u=0;u<24;u++)c[m][u]+=p[m][u]};for(const{key:p}of I)if(e(J)[p]){if(p==="other"){const m=e(R).length?e(R):[["__all__",0]];for(const[u]of m){if(u!=="__all__"&&!Ct(u))continue;const _=u==="__all__"?e(x).other:rt[u];_&&i(_)}continue}if(p==="custom"){const m=e(U).length?e(U):[["__all__",0]];for(const[u]of m){if(u!=="__all__"&&!Bt(u))continue;const _=u==="__all__"?e(x).custom:at[u];_&&i(_)}continue}i(e(x)[p])}return c}function Ct(c){return!e(R).length||Object.keys(e(F)).length===0?!0:e(F)[c]!==!1}function Dt(){if(!e(x))return;const c=At();X("#chart").select("svg").remove();var i={top:30,right:30,bottom:30,left:30},p=750-i.left-i.right,m=450-i.top-i.bottom,u=X("#chart").append("svg").attr("width",p+i.left+i.right).attr("height",m+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],L=[0,1,2,3,4,5,6],y=nt().range([0,p]).domain(_).padding(.01);u.append("g").attr("transform","translate(0,"+m+")").call(Ut(y));var S=nt().range([m,0]).domain(L).padding(.01);u.append("g").call(zt(S));var E=Vt().range(["lightgray","yellow","orange","red"]).domain([1,200,800,4e3]),P=u.append("defs"),j=P.append("linearGradient").attr("id","linear-gradient");j.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),j.selectAll("stop").data(E.range()).enter().append("stop").attr("offset",function(n,M){return M/(E.range().length-1)}).attr("stop-color",function(n){return n});let N=[];for(var g=0;g<7;g++)for(var k=0;k<24;k++)N.push({hour:k,day:g,value:c[g][k]});u.selectAll().data(N,function(n){return n.hour+":"+n.day}).enter().append("rect").attr("x",function(n){return y(n.hour)}).attr("y",function(n){return S(n.day)}).attr("width",y.bandwidth()).attr("height",S.bandwidth()).style("fill",function(n){return E(n.value)});var f=u.append("g").attr("class","legendWrapper").attr("transform","translate("+(p/2-150)+","+(m+20)+")");f.append("rect").attr("width",300).attr("height",10).style("fill","url(#linear-gradient)")}function Bt(c){return!e(U).length||Object.keys(e(G)).length===0?!0:e(G)[c]!==!1}async function Y(){const c=e(D).trim();if(!c){b="",w(a,!1),C="",X("#chart").select("svg").remove();return}w(T,!0),C="",b="",w(a,!1),X("#chart").select("svg").remove();try{const i=new ft.Client(["https://api.hive.blog","https://api.hivekings.com","https://anyx.io","https://api.openhive.network"]),p=new ft.DatabaseAPI(i),m=await i.database.call("lookup_accounts",[c,1]);if(console.log(m),l=await i.database.call("get_accounts",[m]),v=await l[0],console.log(l),console.log(l[0]),c==l[0].name){if(l[0].json_metadata){let f=JSON.parse(l[0].json_metadata);f.profile&&(console.log(f.profile.profile_image),C=f.profile.profile_image)}b=l[0].name}b==""&&(b="!!! Account not found !!!");const u=await i.database.call("get_account_history",["exodegame","-1","10"]);console.log(u),bt=_t=kt=wt="M0 0";const _=Mt();let L=[],y=-1,S=1e3,E=!1;const P=new Map,j={},N=new Map,g={},k=I.reduce((f,n)=>({...f,[n.key]:0}),{});for(let f=0;f<20;f++)y!=0&&!E&&(y>0&&y<1e3&&(S=y),console.log("start: "+y),h=await p.getAccountHistory(c,y,S),console.log(h),await h.forEach(function(n){var it,st,lt;d++,$=n[0],B=n[1].timestamp,L.push($+" "+B+" "+n[1].op[1].id+" "+n[1].op[1].json+`
`),(y==-1||n[0]<y)&&(y=n[0]);var M=new Date(Date.parse(n[1].timestamp+"+00:00")),z=M.getUTCHours(),Z=M.getUTCDay(),ot=new Date,tt=new Date;if(tt.setDate(ot.getDate()-7),M>=tt&&M<=ot){const V=Ot(n[1].op);if(_[V][Z][z]+=50,k[V]=(k[V]||0)+1,V==="other"){const O=((it=n[1].op)==null?void 0:it[0])||"unknown";P.set(O,(P.get(O)||0)+1),j[O]||(j[O]=H()),j[O][Z][z]+=50}else if(V==="custom"){const O=((lt=(st=n[1].op)==null?void 0:st[1])==null?void 0:lt.id)||"unknown";N.set(O,(N.get(O)||0)+1),g[O]||(g[O]=H()),g[O][Z][z]+=50}}M<=tt&&(E=!0)}));w(x,_),w(vt,I.map(f=>({key:f.key,label:f.label,count:k[f.key]||0}))),rt=j,w(R,Array.from(P.entries()).sort((f,n)=>n[1]-f[1])),w(F,e(R).reduce((f,[n])=>({...f,[n]:e(F)[n]??!0}),{})),at=g,w(U,Array.from(N.entries()).sort((f,n)=>n[1]-f[1])),w(G,e(U).reduce((f,[n])=>({...f,[n]:e(G)[n]??!0}),{})),w(a,!0)}finally{w(T,!1)}h.forEach(function(i){d++}),h=await database.getAccountHistory("exodegame",-100,100),h.forEach(function(i){d++})}ct(()=>(e(J),e(F),e(G)),()=>{w(s,JSON.stringify({activity:e(J),other:e(F),custom:e(G)}))}),ct(()=>(e(x),e(a),e(s)),()=>{e(x)&&e(a)&&(e(s),Dt())}),Tt(),Ft(),Jt(t,{title:r,$$slots:{content:(c,i)=>{var p=Xt(),m=q(p),u=q(m),_=q(u),L=q(_);Pt(L);var y=Q(L,2);K(_),K(u),K(m);var S=Q(m,4),E=Q(q(S),2);{var P=g=>{var k=Qt();Lt(4),W(g,k)},j=g=>{var k=Ht(),f=Nt(k);{var n=M=>{var z=St("activity of the last week");W(M,z)};et(f,M=>{e(a)&&M(n)},!0)}W(g,k)};et(E,g=>{e(T)?g(P):g(j,!1)})}var N=Q(E,4);et(N,g=>{e(a)&&Gt}),K(S),K(p),ut("keypress",L,xt),$t(L,()=>e(D),g=>w(D,g)),ut("click",y,Y),W(c,p)}}}),It()}export{ue as component};
